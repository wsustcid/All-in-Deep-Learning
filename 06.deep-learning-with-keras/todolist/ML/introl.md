- [![img](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIkAAAAaCAYAAACD1n8kAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyFpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTQyIDc5LjE2MDkyNCwgMjAxNy8wNy8xMy0wMTowNjozOSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIChXaW5kb3dzKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpDREIwM0FENEE1MjYxMUU4OEI0MTgxQ0FFMkVGMDQ5NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDpDREIwM0FENUE1MjYxMUU4OEI0MTgxQ0FFMkVGMDQ5NyI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkNEQjAzQUQyQTUyNjExRTg4QjQxODFDQUUyRUYwNDk3IiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOkNEQjAzQUQzQTUyNjExRTg4QjQxODFDQUUyRUYwNDk3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+RN+NpAAACQFJREFUeNrsWwlwVEUQ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)](https://ai.yanxishe.com/)

- [首页](https://ai.yanxishe.com/)

- [小组](https://ai.yanxishe.com/page/group)

- [字幕组](https://ai.yanxishe.com/page/translate)

- [博客](https://ai.yanxishe.com/page/blog)

- [问答](https://ai.yanxishe.com/page/question)

- [资源](https://ai.yanxishe.com/page/resources)

- AI工具库

- 

- ![img](https://www.leiphone.com/uploads/new/avatar/05/03/92/62_avatar_pic.jpg?v=15978)

- ![img](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAAPCAYAAAAGRPQsAAABPUlEQVQ4jaXTv0ucQRDG8Y+HChFU1DpoFwgWdgqCiPbWSSFYrUgC8Y+wE7RSuAULOy0ESzsLK1FSJXaC6SwMohYqxB+s7snp63ke+cKwvPPOPO/MOztN5XIZZjCIHtx5P004x34IYbGEOSzjI85QasAu8QELMcb1ZkxgGx0Yb6CqClvYxaek3o4x/MwtthbCa3OKthDCEK5TZck+YxqdyYkW/Ksp8cgJ/oQQRmKMqavOJHSbq0t8SV/KgpXzNY5wjIH8rhs3pfxwU5WQ/uEOrvK0XnKc/f1V/of8UiH0kVGs5aq7q/x/cYjeQsYbYomvWM0C33CBXxguRGaaC57nTOE3fmAFs4WIBsQS89nqUrnt9a5BPZ4G0JXX6H9IE+5JbW7mddjII29k0cUY05Gmf5DEJrGEvhr36j3s4fs9VJpBh8m7iq0AAAAASUVORK5CYII=)

- 

  5

- 

完善资料可以让我们更了解你，还可以获得50研值哦！完善个人资料>

3天内不再提示

[AI研习社](https://ai.yanxishe.com/)>>[博客](https://ai.yanxishe.com/page/blog)>>强化学习传说：第一章 模仿学习

## 强化学习传说：第一章 模仿学习





[![img](https://www.leiphone.com/uploads/new/avatar/05/05/14/82_avatar_pic.jpg)](https://ai.yanxishe.com/page/center/myPage/5051482)

王立鱼

2019年01月31日

本文作者：糖葫芦喵喵

原文链接：<https://zhuanlan.zhihu.com/p/33442519>

------

Hello，大家好，这里是糖葫芦喵喵~！

经过了几个月的奋斗，大家是不是对炼丹已经有所体会了呢？从今天起我们要进入机器学习的一个非常引人注目的领域——强化学习(reinforcement learning)啦！强化学习部分理论较强，不是很好理解。但是不要怕，相信只要读懂了代码就能够理解了！那么，从这里开始为大家带来伯克利深度强化学习CS294 Fall 2017以及斯坦福强化学习CS234 2017的Assginment解析，还请大家多多指教~！

那么，继续我们的炼丹旅程吧~！

## Part 0 CS294与CS234 Assignment简介与环境准备



**1. CS294**

[CS 294: Deep Reinforcement Learning, Fall 2017](http://rll.berkeley.edu/deeprlcourse/)，是加州大学伯克利分校的强化学习课程，该课程往期内容前沿，组织较为随意，主要以实验室paper为主，但是，但是，但是！在Fall 2017的课程组织上有了非常重大的改进！（以前喵喵是不会直接推荐这门课程的，现在强烈推荐！）

CS294 Fall 2017 基本可以分为DRL介绍+模仿学习、model free、model based、Exploration+迁移+多任务+Meta-learning等四大部分。课程需要有一点强化学习和机器学习基础，建议先看完[David Silver的视频](http://www0.cs.ucl.ac.uk/staff/d.silver/web/Teaching.html)，对强化学习概念与方法有一个基本的了解。尤其是bellman方程等内容，CS294并没有讲解，建议内容上互相补充。另外，这门课后半model based部分恰好是对david silver等其他课程、书籍里讲的比较少的内容的非常大的补充，不过这部分难度比较高（控制优化理论）。

CS294一共有四个很有趣的assignment，分别是：模仿学习（行为克隆和DAgger）、策略梯度（AC算法）、DQN和基于模型的Model Predictive Control(MPC)。assignment代码量不大，但是很具有探索性，能够在帮助你理解相关算法的同时让你对强化学习环境[OpenAI Gym](https://github.com/openai/gym)以及[MuJoCo](http://www.mujoco.org/index.html)有一个简单的认识。



**2. CS234**

[CS234: Reinforcement Learning](http://web.stanford.edu/class/cs234/index.html)，是斯坦福大学的强化学习课程，该课程从强化学习介绍与基础知识（MDP、MC、TD）开始，主要讲解了model free、Exploration和策略梯度。前半部分和[David Silver的视频](http://www0.cs.ucl.ac.uk/staff/d.silver/web/Teaching.html)内容可以相互对照学习。有个遗憾是没有视频。

CS234有三个assignment，分别是：[值迭代和策略迭代](http://web.stanford.edu/class/cs234/assignment1/index.html)、[DQN](http://web.stanford.edu/class/cs234/assignment2/index.html)和R-max。其中assignment 1恰好是CS294 assignment所没有体现的部分，可以作为补充。assignment 2 的DQN框架写的很漂亮（虽然一部分是借鉴CS294的2333），值得详细阅读！



**3. 环境准备**

[OpenAI Gym](https://github.com/openai/gym)是开发和测试强化学习算法的开源工具包，提供了一组标准化的环境。

建议使用ubuntu，windows[all]模式未安装成功（简易模式无法进行atari实验）。

首先安装以下包：

```
apt-get install -y python-numpy python-dev cmake zlib1g-dev libjpeg-dev xvfb libav-tools xorg-dev python-opengl libboost-all-dev libsdl2-dev swig
```

然后安装Gym：

```
pip install gym[all]
```

[MuJoCo](http://www.mujoco.org/index.html)(Multi-Joint dynamics with Contact)是一个模拟机器人，生物力学，图形和动画等领域的物理引擎。建议使用linux，CS294要求安装版本为[mjpro131 linux](https://www.roboti.us/download/mjpro131_linux.zip)。

MuJoCo需要[注册](https://www.roboti.us/license.html)才能免费使用30天，请尽量保证在30天内完成作业。注册后通过邮箱接收到mjkey.txt，将这个文件放在mjpro131同级目录下即可。具体位置可参考示例：

/home/username/.mujoco/mjpro131

/home/username/.mujoco/mjkey.txt

其中username是你的用户名（用过linux应该都能明白吧），.mujoco可以手动建立一个。mjpro131是你下载并解压的MuJoCo文件夹，mjkey.txt是注册接收的key。、

至此，复杂的环境配置完毕，可以尝试运行一些demo看看有没有问题。



**4. 文章组织与学习资料**

喵喵这里为了便于理解，打乱了两门课程的作业顺序，分别按照模仿学习（CS294 assignment 1）、值迭代和策略迭代（CS234 assignment 1 部分）、DQN（CS294 assignment 3 \ CS234 assignment 2）、策略梯度（CS294 assignment 2）和基于模型的强化学习（CS294 assignment 4和CS234 assignment 1 部分）的顺序进行讲解。

推荐学习资料：

**喵喵的代码实现：**

> <https://github.com/Observerspy/CS294>
>
> <https://github.com/Observerspy/CS234>

强化学习原理与技术详解：[强化学习知识大讲堂](https://zhuanlan.zhihu.com/sharerl)

CS294课程中文解析：<https://zhuanlan.zhihu.com/c_150977189>

莫烦强化学习系列：[强化学习 Reinforcement Learning 教程系列 | 莫烦Python](https://morvanzhou.github.io/tutorials/machine-learning/reinforcement-learning/)

CS234 2017 课件：某云链接：1dFPlzvr 密码：rsai

开篇讲了这么多，现在让我们愉悦地开始第一个作业模仿学习（CS294 assignment 1）吧！



## Part 1 Behavioral Cloning

Behavioral Cloning，行为克隆，其实本质上就是一个标准的监督学习过程，如下图所示：

![1.jpg](https://static.leiphone.com/uploads/new/sns/article/201901/1548927659653407.jpg)

显然我们是要学习一个输入是观测o，输出是动作a的策略网络。所谓策略就是在给定当前（观测）状态下你所做出的动作选择。于是，明确了我们的数据（观测o，动作a），整个监督学习任务就很清晰了。

我们的实验一共有6个任务：

Hopper，Ant，HalfCheetah，Humanoid，Reacher，Walker2d。

如果你环境配置好了运行demo.bash就能看到6个任务的效果了：

![2.jpg](https://static.leiphone.com/uploads/new/sns/article/201901/1548927670412518.jpg)

单足跳的UMA，四条腿的蚂蚁，两条腿的豹子， 跌跌撞撞的人，够小球的机械臂，两条腿的神奇生物。

先不吐槽这些神奇生物，我们先来运行专家策略run_expert.py生成训练数据，对6个任务分别生成20个rollouts的数据用于训练（每个rollouts默认走1000步，当然有的任务不到1000步就结束了，具体任务具体分析即可）。所以我们拥有20000个训练数据啦！

专家策略的return均值和标准差如下：

Hopper-v1 （input_dim: 11, output_dim: 3）

mean return 3776.51785877 std of return 3.45247967435

Ant-v1 (input_dim: 111, output_dim: 8)

mean return 4832.13478595 std of return 86.6941336401

HalfCheetah-v1 (input_dim: 17, output_dim: 6)

mean return 4132.24798316 std of return 74.760867223

Humanoid-v1 (input_dim: 376, output_dim: 17)

mean return 10401.7386441 std of return 40.9353971034 need more iter

Reacher-v1 (input_dim: 11, output_dim: 2, max_step = 50)

mean return -4.16785312879 std of return 1.74762339869

Walker2d-v1 (input_dim: 17, output_dim: 6)

mean return 5515.55381623 std of return 37.8541602931

然后就是模型，这里喵喵随便弄了一个三层的网络，结构如下：

```
with tf.name_scope('layer1'):
	hidden1 = tf.contrib.layers.fully_connected(self.input_placeholder, 
	num_outputs=128, activation_fn=tf.nn.relu)
with tf.name_scope('layer2'):
	hidden2 = tf.contrib.layers.fully_connected(hidden1, 
	num_outputs=256, activation_fn=tf.nn.relu)
with tf.name_scope('layer3'):
	hidden3 = tf.contrib.layers.fully_connected(hidden2, 
	num_outputs=64, activation_fn=tf.nn.relu)
with tf.name_scope('output'):
	pred = tf.contrib.layers.fully_connected(hidden3, 
	num_outputs=Config.n_classes, activation_fn=None)
```

参数设置：

epoch=20，itera（迭代次数，为了和DAgger对比）=20，batch_size = 256，lr = 0.0005

每一次itera后我们都以学习到的策略运行20个rollouts，并记录returns的均值AverageReturn和标准差StdReturn。

（题外话：其实CS294整个作业下来有两个工具类特别好用，就是logz.py和plot.py，记录画图一气呵成，已经成为喵喵的常备工具了233

画图如下：（其中hopper-big是将网络第二层节点数提高到512个）

![3.jpg](https://static.leiphone.com/uploads/new/sns/article/201901/1548927683340575.jpg)

毕竟其实只训练了itera * epoch = 400（epoch），所以效果也就这样了（为了和DAgger对比）。对比专家策略，也就Ant和HalfCheetah任务勉强接近，其他任务基本上可以说差得很远了，当总epoch更大时Ant和HalfCheetah任务效果更好一些。当然，在我们提高网络节点数量，增强模型表达能力的时候，我们还是可以看到有一个明显的提升的（Hopper）。



## Part 2 DAgger

看来上述简单的方法不太行，问题出在哪里呢？

我们的训练数据分布记为 ![P_{data}(o_t)](https://www.zhihu.com/equation?tex=P_%7Bdata%7D%28o_t%29) ，我们通过模型学习到的策略记为 ![\pi_{\theta }(a_t | o_t)](https://www.zhihu.com/equation?tex=%5Cpi_%7B%5Ctheta+%7D%28a_t+%7C+o_t%29) 。当我们执行我们学习到的策略得到的实际数据分布应为 ![P_{\pi_{\theta }}(o_t)](https://www.zhihu.com/equation?tex=P_%7B%5Cpi_%7B%5Ctheta+%7D%7D%28o_t%29) ，这个分布通常与 ![P_{data}(o_t)](https://www.zhihu.com/equation?tex=P_%7Bdata%7D%28o_t%29) 不一致，除非实际数据分布和训练数据分布完美的一致。因此，我们的Behavioral Cloning在某些任务下很快就偏移了：

![4.jpg](https://static.leiphone.com/uploads/new/sns/article/201901/1548927692291686.jpg)

那么为了解决这个问题，一个很简单的想法就是让 ![P_{data}(o_t)](https://www.zhihu.com/equation?tex=P_%7Bdata%7D%28o_t%29) 能去贴近 ![P_{\pi_{\theta }}(o_t)](https://www.zhihu.com/equation?tex=P_%7B%5Cpi_%7B%5Ctheta+%7D%7D%28o_t%29) 。那么，我们每次在执行完策略 ![\pi_{\theta }(a_t | o_t)](https://www.zhihu.com/equation?tex=%5Cpi_%7B%5Ctheta+%7D%28a_t+%7C+o_t%29) 后对获得的观测 ![o_t](https://www.zhihu.com/equation?tex=o_t) 重新人为给出标记 ![a_t](https://www.zhihu.com/equation?tex=a_t) 不就行了？这样我们把新获得的数据加入到原来的data中重新训练，不断地让 ![P_{data}(o_t)](https://www.zhihu.com/equation?tex=P_%7Bdata%7D%28o_t%29) 去贴近 ![P_{\pi_{\theta }}(o_t)](https://www.zhihu.com/equation?tex=P_%7B%5Cpi_%7B%5Ctheta+%7D%7D%28o_t%29) 。这就是我们的DAgger算法思想：

![5.jpg](https://static.leiphone.com/uploads/new/sns/article/201901/1548927701590104.jpg)

很简单，只是比Behavioral Cloning多了两步：

\1. 从已抽取的data中训练策略网络 ![\pi_{\theta }(a_t | o_t)](https://www.zhihu.com/equation?tex=%5Cpi_%7B%5Ctheta+%7D%28a_t+%7C+o_t%29)

\2. 运行学习策略 ![\pi_{\theta }(a_t | o_t)](https://www.zhihu.com/equation?tex=%5Cpi_%7B%5Ctheta+%7D%28a_t+%7C+o_t%29) 后获得的 ![o_t](https://www.zhihu.com/equation?tex=o_t)

\3. 对获得的 ![o_t](https://www.zhihu.com/equation?tex=o_t) 执行专家策略得到其label： ![a_t](https://www.zhihu.com/equation?tex=a_t)；

\4. 将获得的（ ![o_t](https://www.zhihu.com/equation?tex=o_t), ![a_t](https://www.zhihu.com/equation?tex=a_t)） 加入data重新训练策略。

核心部分实现：

```
for _ in range(10):
	_, o = run_env(env, nn, session) #执行学习到的策略，获得新的观测o
	observations.extend(o)
	action = policy_fn(o) #对新观测的o执行专家策略,获得a作为label
	actions.extend(action)
```

参数设置：

网络结构同上，epoch=20，itera=20，batch_size = 256，lr = 0.0005

初始依然是20 rollouts 数据，每个itera加入10 rollouts 的新数据。

对比结果如下（DA for DAgger, BC for Behavioral Cloning）：

![6.jpg](https://static.leiphone.com/uploads/new/sns/article/201901/1548927710285699.jpg)

可以看到DAgger基本上在同样的参数下都能接近专家策略的return了。

关于更多DAgger算法的问题，请详细的学习CS294第二节。



好了，这就是我们本次对模仿学习的讲解，我们正式踏入了强化学习的门框233。强化学习里非常重要的算法我们后续也都会接触到，不要着急哦。

では、おやすみ～！

![v2-45da0901c663d86b0c2d0bbf00548427_r.jpg](https://static.leiphone.com/uploads/new/sns/article/201901/1548927590852089.jpg)

## 下期预告：CS234 Assignment1 值迭代和策略迭代作业详解





分享



1



加入书包

标签：

 

[强化学习](https://ai.yanxishe.com/page/tag/79)







[![img](https://www.leiphone.com/uploads/new/avatar/05/05/14/82_avatar_pic.jpg)](https://ai.yanxishe.com/page/center/myPage/5051482)

王立鱼

博文*123*阅读量*27243*

[写博客](https://ai.yanxishe.com/page/launchBlog)

发布



![img](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFoAAAAjCAYAAAAUhR0LAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA3FpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo4NDY3MmZlMS1jNzI2LTljNDYtYmYzOC0yOGEzY2U2ZDY0MWEiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6MjUyMTYzMzY1RjFEMTFFODlFMEVDNjQ5OTc2MTQwMzciIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6MjUyMTYzMzU1RjFEMTFFODlFMEVDNjQ5OTc2MTQwMzciIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIChXaW5kb3dzKSI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOmQ5MTdlMjg1LWIxNGUtZjg0Yi1iMzk1LTlmMzUwYzhhNTJjMiIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo4NDY3MmZlMS1jNzI2LTljNDYtYmYzOC0yOGEzY2U2ZDY0MWEiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz4IchdfAAAEBklEQVR42uxZ3XHiMBDGN36HDnAH0EGgAugAPyWPcQdxKji/Ji84FRyp4EwFgQrOqeBwBZz25tubHUWyJRsyNxPtjAZbWuvn291PKxGdz+dRkOtLFIAOQAegg1wB6CiKvjRAT09PifpZ3N3dlS06qfohvUrpVbKN8Y0dBpqonzleT6qjg8M3pD/B60F9czL0ZZJaldQFANVnroGRDMT03zy1dbzhudZBFEJzvsGzUSd2mEChygbPjQCw6xseeCkGp4n/bPmOdB8cgcm1hT4MBHqpg0ROpQA+qseZKuUQY35ra3x+fiZQ16JqjDDpK+QxexSWo6jj9sbQput/lmT4ncDDe0mXRxOoY0Nd2Wcw0M4Cof6L+9PoiNorRETG4arqeDPJDCFc2kLWYX0bCy9Lh3pXZUdOR/TXQiG9gc7E86sqKwKALOvC1S2y4AUM7IcNWIPfeWMiWsnbNjDoLixNiYGK7sXz5YBWtEGUMcXrHhZdCQMMoRD+dneFDGGL1y1Az1yMqXkpGe1RvE8E0CcRcbo8qDbdQFEXR0sgS3gHc+caGURfMG4kTaAUF/LsJUJ9hHHeVN+lz3ypH8pquIimpi9txhZvToT3NiIES1h2DEP0AUdOfGZJCxmUuarTv+e6GsCaPDNROrkI/w0ynnkPx0iFN1N0kEdnWvZVYC0vNkPEDtxcas/3QqfwnPRc23yWWPx3Q1o4EvUjQ92jZrQPeTZ5MuY85wiFZ6cutAWQt4I+K7GpSz3Ovz/k2re3t63pXapZS2YNR7xO1QBrTwdZG7xPTvrgkd7VjhSwYG9W8yVwf8NYiQfInJoeYLzh1KFoQ6Z07wjDRNtxZ8IgPhtaDRDHFmAyPoVBxzW9s4G1hnHXhjETD5BZn/rYEHWpOaRDOVrSxrTjJLciI5i40nbMhXF+dOhNB2QebeBymrpDyTu6O4KLp9AvEQ0EdumTT8eaN8/1Dcrx5JR5HFgOhg1O53EZAZcAdw+QdvI+Q4zVaPoVDMIRO8X8C0R36Zv/xy3e/NKSysh8NXUF2pPHG49IKQxRcBTg1g6RpqeJaxjDSG+9ORr3GjIjyNWOWduuSZHizPj+o+sUZunjbLgpzHocZgqENB+VOz3O4SbxohJbMo1XAtlhcVsRCeUF5lOI0PdJHXdIrXYtm1tiiJyxD0W19JWIA1iu0XGlsKxih9y5bXEMzKzP/YfSj8QCShFRLz59ybuOFjpaWdoaT6OmluM3n0RNbZXRo8kCDos74VJmYvAKeXIyAbY0TQaA1BfmfJ6DDvQ76nNPB/G9Kfyr+1/9lYUsoNb/6dBu2g6m9ivPaWI78ncJ4xv+nP0kCUAHoAPQQQLQAegAdAA6AB2ADhKADkB/dfkjwABtxRAEa/Z9nwAAAABJRU5ErkJggg==) ![img](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFoAAAAjCAYAAAAUhR0LAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA3FpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo4NDY3MmZlMS1jNzI2LTljNDYtYmYzOC0yOGEzY2U2ZDY0MWEiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6MzVFQTgyMjI1RjFEMTFFODhEN0Y4NjQzM0M4MzAyQTAiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6MzVFQTgyMjE1RjFEMTFFODhEN0Y4NjQzM0M4MzAyQTAiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIChXaW5kb3dzKSI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOmQ5MTdlMjg1LWIxNGUtZjg0Yi1iMzk1LTlmMzUwYzhhNTJjMiIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo4NDY3MmZlMS1jNzI2LTljNDYtYmYzOC0yOGEzY2U2ZDY0MWEiLz4gPC9y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) [关于我们](https://www.leiphone.com/us/index)[联系我们](https://www.leiphone.com/us/contact)[意见反馈](https://ai.yanxishe.com/page/feedback)[APP下载](javascript:void(0);)

Copyright 2011-2019 www.leiphone.com 雷锋网 All Rights Reserved 粤ICP备11095991号-20

![img](https://ai.yanxishe.com/static/img/footer-qr.4d72215.jpg)

扫码关注









<iframe id="cros_iframe" src="https://nbrecsys.4paradigm.com/sdk/html/cross-store-server.html" style="color: rgb(51, 51, 51); font-family: &quot;microsoft yahei&quot;, Arial; font-size: medium; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial; width: 1px; height: 1px; border: 0px; position: absolute; left: -9999px; top: -9999px;"></iframe>